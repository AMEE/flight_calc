MooTools.More={version:"1.2.2.2"};Class.refactor=function(c,d){$each(d,function(a,b){var f=c.prototype[b];if(f&&(f=f._origin)&&typeof a=="function"){c.implement(b,function(){var h=this.previous;this.previous=f;var e=a.apply(this,arguments);this.previous=h;return e})}else{c.implement(b,a)}});return c};Class.Occlude=new Class({occlude:function(f,d){d=$(d||this.element);var e=d.retrieve(f||this.property);if(e&&!$defined(this.occluded)){this.occluded=e}else{this.occluded=false;d.store(f||this.property,this)}return this.occluded}});Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(c,d){return this.get("value").substring(c,d)},getSelectedText:function(){if(document.selection&&document.selection.createRange){return document.selection.createRange().text}return this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd())},getSelectedRange:function(){if($defined(this.selectionStart)){return{start:this.selectionStart,end:this.selectionEnd}}var h={start:0,end:0};var g=this.getDocument().selection.createRange();if(!g||g.parentElement()!=this){return h}var j=g.duplicate();if(this.type=="text"){h.start=0-j.moveStart("character",-100000);h.end=h.start+g.text.length}else{var f=this.get("value");var i=f.length-f.match(/[\n\r]*$/)[0].length;j.moveToElementText(this);j.setEndPoint("StartToEnd",g);h.end=i-j.text.length;j.setEndPoint("StartToStart",g);h.start=i-j.text.length}return h},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(b){if(b=="end"){b=this.get("value").length}this.selectRange(b,b);return this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(h,g){if(this.createTextRange){var j=this.get("value");var i=j.substr(h,g-h).replace(/\r/g,"").length;h=j.substr(0,h).replace(/\r/g,"").length;var f=this.createTextRange();f.collapse(true);f.moveEnd("character",h+i);f.moveStart("character",h);f.select()}else{this.focus();this.setSelectionRange(h,g)}return this},insertAtCursor:function(e,f){var g=this.getSelectedRange();var h=this.get("value");this.set("value",h.substring(0,g.start)+e+h.substring(g.end,h.length));if($pick(f,true)){this.selectRange(g.start,g.start+e.length)}else{this.setCaretPosition(g.start+e.length)}return this},insertAroundCursor:function(h,i){h=$extend({before:"",defaultMiddle:"",after:""},h);var n=this.getSelectedText()||h.defaultMiddle;var j=this.getSelectedRange();var k=this.get("value");if(j.start==j.end){this.set("value",k.substring(0,j.start)+h.before+n+h.after+k.substring(j.end,k.length));this.selectRange(j.start+h.before.length,j.end+h.before.length+n.length)}else{var m=k.substring(j.start,j.end);this.set("value",k.substring(0,j.start)+h.before+m+h.after+k.substring(j.end,k.length));var l=j.start+h.before.length;if($pick(i,true)){this.selectRange(l,l+m.length)}else{this.setCaretPosition(l+k.length)}}return this}});Element.implement({measure:function(l){var j=function(a){return !!(!a||a.offsetHeight||a.offsetWidth)};if(j(this)){return l.apply(this)}var m=this.getParent(),h=[],k=[];while(!j(m)&&m!=document.body){h.push(m.expose());m=m.getParent()}var n=this.expose();var i=l.apply(this);n();h.each(function(a){a()});return i},expose:function(){if(this.getStyle("display")!="none"){return $empty}var b=this.getStyles("display","position","visibility");return this.setStyles({display:"block",position:"absolute",visibility:"hidden"}).setStyles.pass(b,this)},getDimensions:function(f){f=$merge({computeSize:false},f);var g={};var h=function(a,b){return(b.computeSize)?a.getComputedSize(b):a.getSize()};if(this.getStyle("display")=="none"){g=this.measure(function(){return h(this,f)})}else{try{g=h(this,f)}catch(e){}}return $chk(g.x)?$extend(g,{width:g.x,height:g.y}):$extend(g,{x:g.width,y:g.height})},getComputedSize:function(g){g=$merge({styles:["padding","border"],plains:{height:["top","bottom"],width:["left","right"]},mode:"both"},g);var j={width:0,height:0};switch(g.mode){case"vertical":delete j.width;delete g.plains.width;break;case"horizontal":delete j.height;delete g.plains.height;break}var f=[];$each(g.plains,function(a,b){a.each(function(c){g.styles.each(function(d){f.push((d=="border")?d+"-"+c+"-width":d+"-"+c)})})});var h={};f.each(function(a){h[a]=this.getComputedStyle(a)},this);var i=[];$each(g.plains,function(b,c){var a=c.capitalize();j["total"+a]=0;j["computed"+a]=0;b.each(function(d){j["computed"+d.capitalize()]=0;f.each(function(e,l){if(e.test(d)){h[e]=h[e].toInt()||0;j["total"+a]=j["total"+a]+h[e];j["computed"+d.capitalize()]=j["computed"+d.capitalize()]+h[e]}if(e.test(d)&&c!=e&&(e.test("border")||e.test("padding"))&&!i.contains(e)){i.push(e);j["computed"+a]=j["computed"+a]-h[e]}})})});["Width","Height"].each(function(a){var b=a.toLowerCase();if(!$chk(j[b])){return}j[b]=j[b]+this["offset"+a]+j["computed"+a];j["total"+a]=j[b]+j["total"+a];delete j["computed"+a]},this);return $extend(h,j)}});(function(){var b=Element.prototype.position;Element.implement({position:function(a){if(a&&($defined(a.x)||$defined(a.y))){return b?b.apply(this,arguments):this}$each(a||{},function(c,d){if(!$defined(c)){delete a[d]}});a=$merge({relativeTo:document.body,position:{x:"center",y:"center"},edge:false,offset:{x:0,y:0},returnPos:false,relFixedPosition:false,ignoreMargins:false,allowNegative:false},a);var H={x:0,y:0};var B=false;var G=this.measure(function(){return $(this.getOffsetParent())});if(G&&G!=this.getDocument().body){H=G.measure(function(){return this.getPosition()});B=true;a.offset.x=a.offset.x-H.x;a.offset.y=a.offset.y-H.y}var s=function(d){if($type(d)!="string"){return d}d=d.toLowerCase();var c={};if(d.test("left")){c.x="left"}else{if(d.test("right")){c.x="right"}else{c.x="center"}}if(d.test("upper")||d.test("top")){c.y="top"}else{if(d.test("bottom")){c.y="bottom"}else{c.y="center"}}return c};a.edge=s(a.edge);a.position=s(a.position);if(!a.edge){if(a.position.x=="center"&&a.position.y=="center"){a.edge={x:"center",y:"center"}}else{a.edge={x:"left",y:"top"}}}this.setStyle("position","absolute");var t=$(a.relativeTo)||document.body;var A=t==document.body?window.getScroll():t.getPosition();var u=A.y;var C=A.x;if(Browser.Engine.trident){var x=t.getScrolls();u+=x.y;C+=x.x}var z=this.getDimensions({computeSize:true,styles:["padding","border","margin"]});if(a.ignoreMargins){a.offset.x=a.offset.x-z["margin-left"];a.offset.y=a.offset.y-z["margin-top"]}var v={};var F=a.offset.y;var E=a.offset.x;var y=window.getSize();switch(a.position.x){case"left":v.x=C+E;break;case"right":v.x=C+E+t.offsetWidth;break;default:v.x=C+((t==document.body?y.x:t.offsetWidth)/2)+E;break}switch(a.position.y){case"top":v.y=u+F;break;case"bottom":v.y=u+F+t.offsetHeight;break;default:v.y=u+((t==document.body?y.y:t.offsetHeight)/2)+F;break}if(a.edge){var w={};switch(a.edge.x){case"left":w.x=0;break;case"right":w.x=-z.x-z.computedRight-z.computedLeft;break;default:w.x=-(z.x/2);break}switch(a.edge.y){case"top":w.y=0;break;case"bottom":w.y=-z.y-z.computedTop-z.computedBottom;break;default:w.y=-(z.y/2);break}v.x=v.x+w.x;v.y=v.y+w.y}v={left:((v.x>=0||B||a.allowNegative)?v.x:0).toInt(),top:((v.y>=0||B||a.allowNegative)?v.y:0).toInt()};if(t.getStyle("position")=="fixed"||a.relFixedPosition){var D=window.getScroll();v.top=v.top.toInt()+D.y;v.left=v.left.toInt()+D.x}if(a.returnPos){return v}else{this.setStyles(v)}return this}})})();var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:(Browser.Engine.trident4||(Browser.Engine.gecko&&!Browser.Engine.gecko19&&Browser.Platform.mac))},property:"IframeShim",initialize:function(c,d){this.element=$(c);if(this.occlude()){return this.occluded}this.setOptions(d);this.makeShim();return this},makeShim:function(){if(this.options.browsers){var f=this.element.getStyle("zIndex").toInt();if(!f){var d=this.element.getStyle("position");if(d=="static"||!d){this.element.setStyle("position","relative")}this.element.setStyle("zIndex",f||1)}f=($chk(this.options.zIndex)&&f>this.options.zIndex)?this.options.zIndex:f-1;if(f<0){f=1}this.shim=new Element("iframe",{src:(window.location.protocol=="https")?"://0":"javascript:void(0)",scrolling:"no",frameborder:0,styles:{zIndex:f,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var e=(function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}).bind(this);if(Browser.Engine.trident&&!IframeShim.ready){window.addEvent("load",e)}else{e()}}else{this.position=this.hide=this.show=this.dispose=$lambda(this)}},position:function(){if(!IframeShim.ready){return this}var b=this.element.measure(function(){return this.getSize()});if($type(this.options.margin)){b.x=b.x-(this.options.margin*2);b.y=b.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}if(this.shim){this.shim.set({width:b.x,height:b.y}).position({relativeTo:this.element,offset:this.options.offset})}return this},hide:function(){if(this.shim){this.shim.setStyle("display","none")}return this},show:function(){if(this.shim){this.shim.setStyle("display","block")}return this.position()},dispose:function(){if(this.shim){this.shim.dispose()}return this},destroy:function(){if(this.shim){this.shim.destroy()}return this}});window.addEvent("load",function(){IframeShim.ready=true});var Clientcide={version:"2.0.2",setAssetLocation:function(b){if(window.StickyWin&&StickyWin.ui){StickyWin.UI.implement({options:{baseHref:b+"/stickyWinHTML/"}});if(StickyWin.alert){var a=StickyWin.alert.bind(window);StickyWin.alert=function(e,d,c){return a(e,d,c||b+"/simple.error.popup")}}}if(window.TagMaker){TagMaker.implement({options:{baseHref:b+"/tips/"}})}if(window.ProductPicker){ProductPicker.implement({options:{baseHref:b+"/Picker"}})}if(window.Autocompleter){Autocompleter.Base.implement({options:{baseHref:b+"/autocompleter/"}})}if(window.Lightbox){Lightbox.implement({options:{assetBaseUrl:b+"/slimbox/"}})}if(window.Waiter){Waiter.implement({options:{baseHref:b+"/waiter/"}})}},preLoadCss:function(){if(window.StickyWin&&StickyWin.ui){StickyWin.ui()}if(window.StickyWin&&StickyWin.pointy){StickyWin.pointy()}Clientcide.preloaded=true;return true},preloaded:false};(function(){if(!window.addEvent){return}var a=function(){if(window.dbug){dbug.log("preloading clientcide css")}if(!Clientcide.preloaded){Clientcide.preLoadCss()}};window.addEvent("domready",a);window.addEvent("load",a)})();setCNETAssetBaseHref=Clientcide.setAssetLocation;var Autocompleter={};var OverlayFix=IframeShim;Autocompleter.Base=new Class({Implements:[Options,Events],options:{minLength:1,markQuery:true,width:"inherit",maxChoices:10,className:"autocompleter-choices",zIndex:42,delay:400,observerOptions:{},fxOptions:{},autoSubmit:false,overflow:false,overflowMargin:25,selectFirst:false,filter:null,filterCase:false,filterSubset:false,forceSelect:false,selectMode:true,choicesMatch:null,multiple:false,separator:", ",separatorSplit:/\s*[,;]\s*/,autoTrim:true,allowDupes:false,cache:true,relative:false},initialize:function(b,a){this.element=$(b);this.setOptions(a);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),$merge({delay:this.options.delay},this.options.observerOptions));this.queryValue=null;if(this.options.filter){this.filter=this.options.filter.bind(this)}var c=this.options.selectMode;this.typeAhead=(c=="type-ahead");this.selectMode=(c===true)?"selection":c;this.cached=[]},build:function(){if($(this.options.customChoices)){this.choices=this.options.customChoices}else{this.choices=new Element("ul",{"class":this.options.className,styles:{zIndex:this.options.zIndex}}).inject(document.body);this.relative=false;if(this.options.relative||this.element.getOffsetParent()!=document.body){this.choices.inject(this.element,"after");this.relative=this.element.getOffsetParent()}this.fix=new OverlayFix(this.choices)}if(!this.options.separator.test(this.options.separatorSplit)){this.options.separatorSplit=this.options.separator}this.fx=(!this.options.fxOptions)?null:new Fx.Tween(this.choices,$merge({property:"opacity",link:"cancel",duration:200},this.options.fxOptions)).addEvent("onStart",Chain.prototype.clearChain).set(0);this.element.setProperty("autocomplete","off").addEvent((Browser.Engine.trident||Browser.Engine.webkit)?"keydown":"keypress",this.onCommand.bind(this)).addEvent("click",this.onCommand.bind(this,[false])).addEvent("focus",this.toggleFocus.create({bind:this,arguments:true,delay:100}));document.addEvent("click",function(a){if(a.target!=this.choices){this.toggleFocus(false)}}.bind(this))},destroy:function(){if(this.fix){this.fix.dispose()}this.choices=this.selected=this.choices.destroy()},toggleFocus:function(a){this.focussed=a;if(!a){this.hideChoices(true)}this.fireEvent((a)?"onFocus":"onBlur",[this.element])},onCommand:function(b){if(!b&&this.focussed){return this.prefetch()}if(b&&b.key&&!b.shift){switch(b.key){case"enter":if(this.element.value!=this.opted){return true}if(this.selected&&this.visible){this.choiceSelect(this.selected);return !!(this.options.autoSubmit)}break;case"up":case"down":if(!this.prefetch()&&this.queryValue!==null){var a=(b.key=="up");this.choiceOver((this.selected||this.choices)[(this.selected)?((a)?"getPrevious":"getNext"):((a)?"getLast":"getFirst")](this.options.choicesMatch),true)}return false;case"esc":case"tab":this.hideChoices(true);break}}return true},setSelection:function(g){var h=this.selected.inputValue,i=h;var b=this.queryValue.length,d=h.length;if(h.substr(0,b).toLowerCase()!=this.queryValue.toLowerCase()){b=0}if(this.options.multiple){var f=this.options.separatorSplit;i=this.element.value;b+=this.queryIndex;d+=this.queryIndex;var c=i.substr(this.queryIndex).split(f,1)[0];i=i.substr(0,this.queryIndex)+h+i.substr(this.queryIndex+c.length);if(g){var a=/[^\s,]+/;var e=i.split(this.options.separatorSplit).filter(a.test,a);if(!this.options.allowDupes){e=[].combine(e)}var j=this.options.separator;i=e.join(j)+j;d=i.length}}this.observer.setValue(i);this.opted=i;if(g||this.selectMode=="pick"){b=d}this.element.selectRange(b,d);this.fireEvent("onSelection",[this.element,this.selected,i,h])},showChoices:function(){var c=this.options.choicesMatch,g=this.choices.getFirst(c);this.selected=this.selectedValue=null;if(this.fix){var h=this.element.getCoordinates(this.relative),d=this.options.width||"auto";this.choices.setStyles({left:h.left,top:h.bottom,width:(d===true||d=="inherit")?h.width:d})}if(!g){return}if(!this.visible){this.visible=true;this.choices.setStyle("display","");if(this.fx){this.fx.start(1)}this.fireEvent("onShow",[this.element,this.choices])}if(this.options.selectFirst||this.typeAhead||g.inputValue==this.queryValue){this.choiceOver(g,this.typeAhead)}var b=this.choices.getChildren(c),a=this.options.maxChoices;var f={overflowY:"hidden",height:""};this.overflown=false;if(b.length>a){var e=b[a-1];f.overflowY="scroll";f.height=e.getCoordinates(this.choices).bottom;this.overflown=true}this.choices.setStyles(f);this.fix.show()},hideChoices:function(a){if(a){var c=this.element.value;if(this.options.forceSelect){c=this.opted}if(this.options.autoTrim){c=c.split(this.options.separatorSplit).filter($arguments(0)).join(this.options.separator)}this.observer.setValue(c)}if(!this.visible){return}this.visible=false;this.observer.clear();var b=function(){this.choices.setStyle("display","none");this.fix.hide()}.bind(this);if(this.fx){this.fx.start(0).chain(b)}else{b()}this.fireEvent("onHide",[this.element,this.choices])},prefetch:function(){var f=this.element.value,e=f;if(this.options.multiple){var c=this.options.separatorSplit;var a=f.split(c);var b=this.element.getCaretPosition();var g=f.substr(0,b).split(c);var d=g.length-1;b-=g[d].length;e=a[d]}if(e.length<this.options.minLength){this.hideChoices()}else{if(e===this.queryValue||(this.visible&&e==this.selectedValue)){if(this.visible){return false}this.showChoices()}else{this.queryValue=e;this.queryIndex=b;if(!this.fetchCached()){this.query()}}}return true},fetchCached:function(){return false;if(!this.options.cache||!this.cached||!this.cached.length||this.cached.length>=this.options.maxChoices||this.queryValue){return false}this.update(this.filter(this.cached));return true},update:function(a){this.choices.empty();this.cached=a;if(!a||!a.length){this.hideChoices()}else{if(this.options.maxChoices<a.length&&!this.options.overflow){a.length=this.options.maxChoices}a.each(this.options.injectChoice||function(c){var b=new Element("li",{html:this.markQueryValue(c)});b.inputValue=c;this.addChoiceEvents(b).inject(this.choices)},this);this.showChoices()}},choiceOver:function(c,d){if(!c||c==this.selected){return}if(this.selected){this.selected.removeClass("autocompleter-selected")}this.selected=c.addClass("autocompleter-selected");this.fireEvent("onSelect",[this.element,this.selected,d]);if(!d){return}this.selectedValue=this.selected.inputValue;if(this.overflown){var f=this.selected.getCoordinates(this.choices),e=this.options.overflowMargin,g=this.choices.scrollTop,a=this.choices.offsetHeight,b=g+a;if(f.top-e<g&&g){this.choices.scrollTop=Math.max(f.top-e,0)}else{if(f.bottom+e>b){this.choices.scrollTop=Math.min(f.bottom-a+e,b)}}}if(this.selectMode){this.setSelection()}},choiceSelect:function(a){if(a){this.choiceOver(a)}this.setSelection(true);this.queryValue=false;this.hideChoices()},filter:function(b){var a=new RegExp(((this.options.filterSubset)?"":"^")+this.queryValue.escapeRegExp(),(this.options.filterCase)?"":"i");return(b||this.tokens).filter(a.test,a)},markQueryValue:function(a){return(!this.options.markQuery||!this.queryValue)?a:a.replace(new RegExp("("+((this.options.filterSubset)?"":"^")+this.queryValue.escapeRegExp()+")",(this.options.filterCase)?"":"i"),'<span class="autocompleter-queried">$1</span>')},addChoiceEvents:function(a){return a.addEvents({mouseover:this.choiceOver.bind(this,[a]),click:this.choiceSelect.bind(this,[a])})}});Autocompleter.Local=new Class({Extends:Autocompleter.Base,options:{minLength:0,delay:200},initialize:function(b,c,a){this.parent(b,a);this.tokens=c},query:function(){this.update(this.filter())}});Autocompleter.Ajax={};Autocompleter.Ajax.Base=new Class({Extends:Autocompleter.Base,options:{postVar:"value",postData:{},ajaxOptions:{},onRequest:$empty,onComplete:$empty},initialize:function(c,b){this.parent(c,b);var a=$(this.options.indicator);if(a){this.addEvents({onRequest:a.show.bind(a),onComplete:a.hide.bind(a)},true)}},query:function(){var a=$unlink(this.options.postData);a[this.options.postVar]=this.queryValue;this.fireEvent("onRequest",[this.element,this.request,a,this.queryValue]);this.request.send({data:a})},queryResponse:function(){this.fireEvent("onComplete",[this.element,this.request,this.response])}});Autocompleter.Ajax.Json=new Class({Extends:Autocompleter.Ajax.Base,initialize:function(c,b,a){this.parent(c,a);this.request=new Request.JSON($merge({url:b,link:"cancel"},this.options.ajaxOptions)).addEvent("onComplete",this.queryResponse.bind(this))},queryResponse:function(a){this.parent();this.update(a)}});Autocompleter.Ajax.Xhtml=new Class({Extends:Autocompleter.Ajax.Base,initialize:function(c,b,a){this.parent(c,a);this.request=new Request.HTML($merge({url:b,link:"cancel",update:this.choices},this.options.ajaxOptions)).addEvent("onComplete",this.queryResponse.bind(this))},queryResponse:function(a,b){this.parent();if(!b||!b.length){this.hideChoices()}else{this.choices.getChildren(this.options.choicesMatch).each(this.options.injectChoice||function(c){var d=c.innerHTML;c.inputValue=d;this.addChoiceEvents(c.set("html",this.markQueryValue(d)))},this);this.showChoices()}}});var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(c,a,b){this.setOptions(b);this.addEvent("onFired",a);this.element=$(c)||$$(c);this.boundChange=this.changed.bind(this);this.resume()},changed:function(){var a=this.element.get("value");if($equals(this.value,a)){return}this.clear();this.value=a;this.timeout=this.onFired.delay(this.options.delay,this)},setValue:function(a){this.value=a;this.element.set("value",a);return this.clear()},onFired:function(){this.fireEvent("onFired",[this.value,this.element])},clear:function(){$clear(this.timeout||null);return this},pause:function(){$clear(this.timeout);$clear(this.timer);this.element.removeEvent("keyup",this.boundChange);return this},resume:function(){this.value=this.element.get("value");if(this.options.periodical){this.timer=this.changed.periodical(this.options.periodical,this)}else{this.element.addEvent("keyup",this.boundChange)}return this}});var $equals=function(b,a){return(b==a||JSON.encode(b)==JSON.encode(a))};(function(){Autocompleter.Base=Class.refactor(Autocompleter.Base,{options:{baseHref:"http://www.cnet.com/html/rb/assets/global/autocompleter/"},initialize:function(b,a,c){this.previous(b,a,c);this.writeStyle()},writeStyle:function(){window.addEvent("domready",function(){if($("AutocompleterCss")){return}new Element("link",{rel:"stylesheet",media:"screen",type:"text/css",href:this.options.baseHref+"Autocompleter.css",id:"AutocompleterCss"}).inject(document.head)}.bind(this))}})})();Element.alias("isVisible","isDisplayed");IframeShim=Class.refactor(IframeShim,{initialize:function(b,a){if(a&&a.zindex){a.zIndex=a.zindex}this.previous(b,a)}});var FormCheck=new Class({Implements:[Options,Events],options:{tipsClass:"fc-tbx",errorClass:"fc-error",fieldErrorClass:"fc-field-error",trimValue:false,validateDisabled:false,submitByAjax:false,ajaxResponseDiv:false,ajaxEvalScripts:false,onAjaxRequest:$empty,onAjaxSuccess:$empty,onAjaxFailure:$empty,display:{showErrors:0,titlesInsteadNames:0,errorsLocation:1,indicateErrors:1,indicateErrorsInit:0,keepFocusOnError:0,checkValueIfEmpty:1,addClassErrorToField:0,fixPngForIe:1,replaceTipsEffect:1,flashTips:0,closeTipsButton:1,tipsPosition:"right",tipsOffsetX:-45,tipsOffsetY:0,listErrorsAtTop:false,scrollToFirst:true,fadeDuration:300},alerts:{required:"This field is required.",alpha:"This field accepts alphabetic characters only.",alphanum:"This field accepts alphanumeric characters only.",nodigit:"No digits are accepted.",digit:"Please enter a valid integer.",digitltd:"The value must be between %0 and %1",number:"Please enter a valid number.",email:"Please enter a valid email.",phone:"Please enter a valid phone.",url:"Please enter a valid url.",confirm:"This field is different from %0",differs:"This value must be different of %0",length_str:"The length is incorrect, it must be between %0 and %1",length_fix:"The length is incorrect, it must be exactly %0 characters",lengthmax:"The length is incorrect, it must be at max %0",lengthmin:"The length is incorrect, it must be at least %0",checkbox:"Please check the box",radios:"Please select a radio",select:"Please choose a value"},regexp:{required:/[^.*]/,alpha:/^[a-z ._-]+$/i,alphanum:/^[a-z0-9 ._-]+$/i,digit:/^[-+]?[0-9]+$/,nodigit:/^[^0-9]+$/,number:/^[-+]?\d*\.?\d+$/,email:/^[a-z0-9._%-]+@[a-z0-9.-]+\.[a-z]{2,4}$/i,phone:/^[\d\s ().-]+$/,url:/^(http|https|ftp)\:\/\/[a-z0-9\-\.]+\.[a-z]{2,3}(:[a-z0-9]*)?\/?([a-z0-9\-\._\?\,\'\/\\\+&amp;%\$#\=~])*$/i}},initialize:function(b,a){if(this.form=$(b)){this.form.isValid=true;this.regex=["length"];this.setOptions(a);if(typeof(formcheckLanguage)!="undefined"){this.options.alerts=$merge(this.options.alerts,formcheckLanguage)}this.validations=[];this.alreadyIndicated=false;this.firstError=false;var c=new Hash(this.options.regexp);c.each(function(d,e){this.regex.push(e)},this);this.form.getElements("*[class*=validate]").each(function(d){this.register(d)},this);this.form.addEvents({submit:this.onSubmit.bind(this)});if(this.options.display.fixPngForIe){this.fixIeStuffs()}document.addEvent("mousewheel",function(){this.isScrolling=false}.bind(this))}},register:function(el){el.validation=[];el.getProperty("class").split(" ").each(function(classX){if(classX.match(/^validate(\[.+\])$/)){var validators=eval(classX.match(/^validate(\[.+\])$/)[1]);for(var i=0;i<validators.length;i++){el.validation.push(validators[i]);if(validators[i].match(/^confirm\[/)){var field=eval(validators[i].match(/^.+(\[.+\])$/)[1].replace(/([A-Z0-9\._-]+)/i,"'$1'"));if(this.form[field].validation.contains("required")){el.validation.push("required")}}}this.addListener(el)}},this)},dispose:function(a){this.validations.erase(a)},addListener:function(b){this.validations.push(b);b.errors=[];if(this.options.display.indicateErrorsInit){this.validations.each(function(c){if(!this.manageError(c,"submit")){this.form.isValid=false}},this);return true}if(b.validation[0]=="submit"){b.addEvent("click",function(c){this.onSubmit(c)}.bind(this));return true}if(this.isChildType(b)==false){b.addEvent("blur",function(){(function(){if(!this.fxRunning&&(b.element||this.options.display.showErrors==1)&&(this.options.display.checkValueIfEmpty||b.value)){this.manageError(b,"blur")}}.bind(this)).delay(100)}.bind(this))}else{if(this.isChildType(b)==true){var a=this.form.getElements('input[name="'+b.getProperty("name")+'"]');a.each(function(c){c.addEvent("blur",function(){(function(){if((b.element||this.options.display.showErrors==1)&&(this.options.display.checkValueIfEmpty||b.value)){this.manageError(b,"click")}}.bind(this)).delay(100)}.bind(this))},this)}}},validate:function(el){el.errors=[];el.isOk=true;if(!this.options.validateDisabled&&el.get("disabled")){return true}if(this.options.trimValue&&el.value){el.value=el.value.trim()}el.validation.each(function(rule){if(this.isChildType(el)){if(this.validateGroup(el)==false){el.isOk=false}}else{var ruleArgs=[];if(rule.match(/^.+\[/)){var ruleMethod=rule.split("[")[0];ruleArgs=eval(rule.match(/^.+(\[.+\])$/)[1].replace(/([A-Z0-9\._-]+)/i,"'$1'"))}else{var ruleMethod=rule}if(this.regex.contains(ruleMethod)&&el.get("tag")!="select"){if(this.validateRegex(el,ruleMethod,ruleArgs)==false){el.isOk=false}}if(ruleMethod=="confirm"){if(this.validateConfirm(el,ruleArgs)==false){el.isOk=false}}if(ruleMethod=="differs"){if(this.validateDiffers(el,ruleArgs)==false){el.isOk=false}}if(el.get("tag")=="select"||(el.type=="checkbox"&&ruleMethod=="required")){if(this.simpleValidate(el)==false){el.isOk=false}}if(rule.match(/%[A-Z0-9\._-]+$/i)||(el.isOk&&rule.match(/~[A-Z0-9\._-]+$/i))){if(eval(rule.slice(1)+"(el)")==false){el.isOk=false}}}},this);if(el.isOk){return true}else{return false}},simpleValidate:function(a){if(a.get("tag")=="select"&&a.selectedIndex<=0){a.errors.push(this.options.alerts.select);return false}else{if(a.type=="checkbox"&&a.checked==false){a.errors.push(this.options.alerts.checkbox);return false}}return true},validateRegex:function(e,f,d){var c="";if(d[1]&&f=="length"){if(d[1]==-1){this.options.regexp.length=new RegExp("^[\\s\\S]{"+d[0]+",}$");c=this.options.alerts.lengthmin.replace("%0",d[0])}else{if(d[0]==d[1]){this.options.regexp.length=new RegExp("^[\\s\\S]{"+d[0]+"}$");c=this.options.alerts.length_fix.replace("%0",d[0])}else{this.options.regexp.length=new RegExp("^[\\s\\S]{"+d[0]+","+d[1]+"}$");c=this.options.alerts.length_str.replace("%0",d[0]).replace("%1",d[1])}}}else{if(d[0]&&f=="length"){this.options.regexp.length=new RegExp("^.{0,"+d[0]+"}$");c=this.options.alerts.lengthmax.replace("%0",d[0])}else{c=this.options.alerts[f]}}if(d[1]&&f=="digit"){var a=true;if(!this.options.regexp.digit.test(e.value)){e.errors.push(this.options.alerts[f]);a=false}if(d[1]==-1){if(e.value>=d[0]){var b=true}else{var b=false}c=this.options.alerts.digitmin.replace("%0",d[0])}else{if(e.value>=d[0]&&e.value<=d[1]){var b=true}else{var b=false}c=this.options.alerts.digitltd.replace("%0",d[0]).replace("%1",d[1])}if(a==false||b==false){e.errors.push(c);return false}}else{if(this.options.regexp[f].test(e.value)==false){e.errors.push(c);return false}}return true},validateConfirm:function(d,c){var a=c[0];if(d.value!=this.form[a].value){if(this.options.display.titlesInsteadNames){var b=this.options.alerts.confirm.replace("%0",this.form[a].getProperty("title"))}else{var b=this.options.alerts.confirm.replace("%0",a)}d.errors.push(b);return false}return true},validateDiffers:function(a,c){var d=c[0];if(a.value==this.form[d].value){if(this.options.display.titlesInsteadNames){var b=this.options.alerts.differs.replace("%0",this.form[d].getProperty("title"))}else{var b=this.options.alerts.differs.replace("%0",d)}a.errors.push(b);return false}return true},isChildType:function(a){return($defined(a.type)&&a.type=="radio")?true:false},validateGroup:function(b){b.errors=[];var a=this.form[b.getProperty("name")];b.group=a;var c=false;for(var d=0;d<a.length;d++){if(a[d].checked){c=true}}if(c==false){b.errors.push(this.options.alerts.radios);return false}else{return true}},listErrorsAtTop:function(a){if(!this.form.element){this.form.element=new Element("div",{id:"errorlist","class":this.options.errorClass}).injectTop(this.form)}if($type(a)=="collection"){new Element("p").set("html","<span>"+a[0].name+" : </span>"+a[0].errors[0]).injectInside(this.form.element)}else{if((a.validation.contains("required")&&a.errors.length>0)||(a.errors.length>0&&a.value&&a.validation.contains("required")==false)){a.errors.each(function(b){new Element("p").set("html","<span>"+a.name+" : </span>"+b).injectInside(this.form.element)},this)}}},manageError:function(a,b){var c=this.validate(a);if((!c&&a.validation.flatten()[0].contains("confirm["))||(!c&&a.validation.contains("required"))||(!a.validation.contains("required")&&a.value&&!c)){if(this.options.display.listErrorsAtTop==true&&b=="submit"){this.listErrorsAtTop(a,b)}if(this.options.display.indicateErrors==2||this.alreadyIndicated==false||a.name==this.alreadyIndicated.name){if(!this.firstError){this.firstError=a}this.alreadyIndicated=a;if(this.options.display.keepFocusOnError&&a.name==this.firstError.name){(function(){a.focus()}).delay(20)}this.addError(a);return false}}else{if((c||(!a.validation.contains("required")&&!a.value))&&a.element){this.removeError(a);return true}}return true},addError:function(d){if(!d.element&&this.options.display.indicateErrors!=0){if(this.options.display.errorsLocation==1){var b=(this.options.display.tipsPosition=="left")?d.getCoordinates().left:d.getCoordinates().right;var e={opacity:0,position:"absolute","float":"left",left:b+this.options.display.tipsOffsetX};d.element=new Element("div",{"class":this.options.tipsClass,styles:e}).injectInside(document.body);this.addPositionEvent(d)}else{if(this.options.display.errorsLocation==2){d.element=new Element("div",{"class":this.options.errorClass,styles:{opacity:0}}).injectBefore(d)}else{if(this.options.display.errorsLocation==3){d.element=new Element("div",{"class":this.options.errorClass,styles:{opacity:0}});if($type(d.group)=="object"||$type(d.group)=="collection"){d.element.injectAfter(d.group[d.group.length-1])}else{d.element.injectAfter(d)}}}}}if(d.element&&d.element!=true){d.element.empty();if(this.options.display.errorsLocation==1){var c=[];d.errors.each(function(f){c.push(new Element("p").set("html",f))});var a=this.makeTips(c).injectInside(d.element);if(this.options.display.closeTipsButton){a.getElements("a.close").addEvent("mouseup",function(){this.removeError(d)}.bind(this))}d.element.setStyle("top",d.getCoordinates().top+d.getCoordinates().height+this.options.display.tipsOffsetY)}else{d.errors.each(function(f){new Element("p").set("html",f).injectInside(d.element)})}if(!this.options.display.fadeDuration||Browser.Engine.trident&&Browser.Engine.version==5&&this.options.display.errorsLocation<2){d.element.setStyle("opacity",1)}else{d.fx=new Fx.Tween(d.element,{duration:this.options.display.fadeDuration,ignore:true,onStart:function(){this.fxRunning=true}.bind(this),onComplete:function(){this.fxRunning=false;if(d.element&&d.element.getStyle("opacity").toInt()==0){d.element.destroy();d.element=false}}.bind(this)});if(d.element.getStyle("opacity").toInt()!=1){d.fx.start("opacity",1)}}}if(this.options.display.addClassErrorToField&&this.isChildType(d)==false){d.addClass(this.options.fieldErrorClass);d.element=d.element||true}},addPositionEvent:function(a){if(this.options.display.replaceTipsEffect){a.event=function(){new Fx.Morph(a.element,{duration:this.options.display.fadeDuration}).start({left:[a.element.getStyle("left"),a.getCoordinates().left+this.options.display.tipsOffsetX],top:[a.element.getStyle("top"),a.getCoordinates().top+a.getCoordinates().height+this.options.display.tipsOffsetY]})}.bind(this)}else{a.event=function(){a.element.setStyles({left:a.getCoordinates().left+this.options.display.tipsOffsetX,top:a.getCoordinates().top+a.getCoordinates().height+this.options.display.tipsOffsetY})}.bind(this)}window.addEvent("resize",a.event)},removeError:function(a){this.alreadyIndicated=false;a.errors=[];a.isOK=true;window.removeEvent("resize",a.event);if(this.options.display.errorsLocation>=2&&a.element){new Fx.Tween(a.element,{duration:this.options.display.fadeDuration}).start("height",0)}if(!this.options.display.fadeDuration||Browser.Engine.trident&&Browser.Engine.version==5&&this.options.display.errorsLocation==1&&a.element){this.fxRunning=true;a.element.destroy();a.element=false;(function(){this.fxRunning=false}.bind(this)).delay(200)}else{if(a.element&&a.element!=true){a.fx.start("opacity",0)}}if(this.options.display.addClassErrorToField&&!this.isChildType(a)){a.removeClass(this.options.fieldErrorClass)}},focusOnError:function(b){if(this.options.display.scrollToFirst&&!this.alreadyFocused&&!this.isScrolling){if(!this.options.display.indicateErrors||!this.options.display.errorsLocation){var a=b.getCoordinates().top-30}else{if(this.alreadyIndicated.element){switch(this.options.display.errorsLocation){case 1:var a=b.element.getCoordinates().top;break;case 2:var a=b.element.getCoordinates().top-30;break;case 3:var a=b.getCoordinates().top-30;break}this.isScrolling=true}}if(window.getScroll.y!=a){new Fx.Scroll(window,{onComplete:function(){this.isScrolling=false;b.focus()}.bind(this)}).start(0,a)}else{this.isScrolling=false;b.focus()}this.alreadyFocused=true}},fixIeStuffs:function(){if(Browser.Engine.trident4){var h=new RegExp("url\\(([.a-zA-Z0-9_/:-]+.png)\\)");var f=new RegExp("(.+)formcheck.css");for(var b=0;b<document.styleSheets.length;b++){if(document.styleSheets[b].href.match(/formcheck\.css$/)){var i=document.styleSheets[b].href.replace(f,"$1");var a=document.styleSheets[b].rules.length;for(var c=0;c<a;c++){var e=document.styleSheets[b].rules[c].style;var g=i+e.backgroundImage.replace(h,"$1");if(g&&g.match(/\.png/i)){var d=(e.backgroundRepeat=="no-repeat")?"crop":"scale";e.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, src='"+g+"', sizingMethod='"+d+"')";e.backgroundImage="none"}}}}}},makeTips:function(g){var e=new Element("table");e.cellPadding="0";e.cellSpacing="0";e.border="0";var f=new Element("tbody").injectInside(e);var h=new Element("tr").injectInside(f);new Element("td",{"class":"tl"}).injectInside(h);new Element("td",{"class":"t"}).injectInside(h);new Element("td",{"class":"tr"}).injectInside(h);var b=new Element("tr").injectInside(f);new Element("td",{"class":"l"}).injectInside(b);var a=new Element("td",{"class":"c"}).injectInside(b);var c=new Element("div",{"class":"err"}).injectInside(a);g.each(function(i){i.injectInside(c)});if(this.options.display.closeTipsButton){new Element("a",{"class":"close"}).injectInside(a)}new Element("td",{"class":"r"}).injectInside(b);var d=new Element("tr").injectInside(f);new Element("td",{"class":"bl"}).injectInside(d);new Element("td",{"class":"b"}).injectInside(d);new Element("td",{"class":"br"}).injectInside(d);return e},reinitialize:function(){this.validations.each(function(a){if(a.element){a.errors=[];a.isOK=true;if(this.options.display.flashTips==1){a.element.destroy();a.element=false}}},this);if(this.form.element){this.form.element.empty()}this.alreadyFocused=false;this.firstError=false;this.elementToRemove=this.alreadyIndicated;this.alreadyIndicated=false;this.form.isValid=true},submitByAjax:function(){var a=this.form.getProperty("action");this.fireEvent("ajaxRequest");new Request({url:a,method:this.form.getProperty("method"),data:this.form.toQueryString(),evalScripts:this.options.ajaxEvalScripts,onFailure:function(b){this.fireEvent("ajaxFailure",b)}.bind(this),onSuccess:function(b){this.fireEvent("ajaxSuccess",b);if(this.options.ajaxResponseDiv){$(this.options.ajaxResponseDiv).set("html",b)}}.bind(this)}).send()},onSubmit:function(a){this.reinitialize();this.validations.each(function(b){var c=this.manageError(b,"submit");if(!c){this.form.isValid=false}},this);if(this.form.isValid){if(this.options.submitByAjax){new Event(a).stop();this.submitByAjax()}}else{new Event(a).stop();if(this.elementToRemove&&this.elementToRemove!=this.firstError&&this.options.display.indicateErrors==1){this.removeError(this.elementToRemove)}this.focusOnError(this.firstError)}}});window.addEvent("domready",function(){if($("flightOrigin")){var a=new Autocompleter.Ajax.Json($("flightOrigin"),"/airports/search.json",{minLength:1,postVar:"airport",postData:{},ajaxOptions:{method:"get",onRequest:function(){$("flightOrigin").addClass("loading")},onFailure:function(){$("flightOrigin").removeClass("loading")},onComplete:function(){$("flightOrigin").removeClass("loading")}},overflow:true,injectChoice:function(d){if(d.error_code){}else{var c=new Element("li",{html:this.markQueryValue(d.address)});c.value=d.id;c.inputValue=d.address;this.addChoiceEvents(c).inject(this.choices)}},onSelection:function(c,d){$("flight_co2_calculation_origin_airport_id").set("value",d.value)}}).observer.addEvent("onFired",function(c){if(!c){$("flight_co2_calculation_origin_airport_id").set("value","")}})}if($("flightDestination")){var a=new Autocompleter.Ajax.Json($("flightDestination"),"/airports/search.json",{minLength:1,postVar:"airport",postData:{},ajaxOptions:{method:"get",onRequest:function(){$("flightDestination").addClass("loading")},onFailure:function(){$("flightDestination").removeClass("loading")},onComplete:function(){$("flightDestination").removeClass("loading")}},overflow:true,injectChoice:function(d){if(d.error_code){}else{var c=new Element("li",{html:this.markQueryValue(d.address)});c.value=d.id;c.inputValue=d.address;this.addChoiceEvents(c).inject(this.choices)}},onSelection:function(c,d){$("flight_co2_calculation_destination_airport_id").set("value",d.value)}}).observer.addEvent("onFired",function(c){if(!c){$("flight_co2_calculation_destination_airport_id").set("value","")}})}var b=new FormCheck("carbonCalculator",{display:{scrollToFirst:false,tipsPosition:"left",tipsOffsetX:-60,tipsOffsetY:5},alerts:{required:"Please make sure you have entered an airport."}})});